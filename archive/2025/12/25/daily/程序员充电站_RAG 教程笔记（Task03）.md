---
title: RAG 教程笔记（Task03）
url: https://itcharge.cn/tech/llm-dev/rag-tutorial-03/
source: 程序员充电站
date: 2025-12-25
fetch_date: 2025-12-26T03:27:09.441778
---

# RAG 教程笔记（Task03）

# [![](https://itcharge.cn/wp-content/uploads/header-logo.png)](https://itcharge.cn/)

[Menu](#0)

* [жҠҖжңҜ](https://itcharge.cn/category/tech/)
  + [iOS ејҖеҸ‘](https://itcharge.cn/category/tech/ios-dev/)
  + [з®—жі• & ж•°жҚ®з»“жһ„](https://itcharge.cn/category/tech/algorithm/)
  + [Hexo еҚҡе®ў](https://itcharge.cn/category/tech/hexo-blog/)
  + [WordPress еҚҡе®ў](https://itcharge.cn/category/tech/wordpress-blog/)
* [й«ҳж•ҲзҺҮ](https://itcharge.cn/category/efficient/)
  + [macOS жҠҖе·§](https://itcharge.cn/category/efficient/macos-tip/)
  + [е·Ҙе…·жҖқз»ҙ](https://itcharge.cn/category/efficient/tool-mind/)
* [ж…ўз”ҹжҙ»](https://itcharge.cn/category/life/)
  + [иҜ»д№Ұз¬”и®°](https://itcharge.cn/category/life/book-notes/)
  + [еӯҰд№ жҲҗй•ҝ](https://itcharge.cn/category/life/learning/)
  + [еҺЁиүәзҫҺйЈҹ](https://itcharge.cn/category/life/cooking/)
  + [иҜ—ж„Ҹдәәз”ҹ](https://itcharge.cn/category/life/brilliant-life/)
  + [иҖғз ”зӣёе…і](https://itcharge.cn/category/life/graduate-test/)
* [е…ідәҺжҲ‘](https://itcharge.cn/life/about-me/)

# RAG ж•ҷзЁӢз¬”и®°пјҲTask03пјү

[2025-12-25](https://itcharge.cn/tech/llm-dev/rag-tutorial-03/)

2.998k еӯ—  |  10 еҲҶй’ҹ

## 5. зҙўеј•жһ„е»ә

### 5.1 еҗ‘йҮҸеөҢе…Ҙ

**еҗ‘йҮҸеөҢе…ҘпјҲEmbeddingпјү**пјҡе°ҶеӨҚжқӮж•°жҚ®еҜ№иұЎпјҲж–Үжң¬гҖҒеӣҫеғҸзӯүпјүиҪ¬жҚўдёәдҪҺз»ҙзЁ еҜҶж•°еҖјеҗ‘йҮҸзҡ„жҠҖжңҜгҖӮж ёеҝғеҺҹеҲҷжҳҜ**иҜӯд№үзӣёдјјзҡ„еҜ№иұЎеңЁеҗ‘йҮҸз©әй—ҙдёӯи·қзҰ»жӣҙиҝ‘**пјҢеёёз”ЁдҪҷејҰзӣёдјјеәҰгҖҒзӮ№з§ҜгҖҒж¬§ж°Ҹи·қзҰ»иЎЎйҮҸзӣёдјјеәҰгҖӮ

**еңЁ RAG дёӯзҡ„дҪңз”Ё**пјҡ

* **иҜӯд№үжЈҖзҙўеҹәзЎҖ**пјҡзҰ»зәҝе°Ҷж–ҮжЎЈеқ—еҗ‘йҮҸеҢ–еӯҳе…Ҙеҗ‘йҮҸеә“пјҢеңЁзәҝе°Ҷз”ЁжҲ·й—®йўҳеҗ‘йҮҸеҢ–пјҢйҖҡиҝҮзӣёдјјеәҰи®Ўз®—еҸ¬еӣһ Top-K зӣёе…іж–ҮжЎЈеқ—
* **еҶіе®ҡжЈҖзҙўиҙЁйҮҸ**пјҡEmbedding иҙЁйҮҸзӣҙжҺҘеҪұе“ҚеҸ¬еӣһеҶ…е®№зҡ„еҮҶзЎ®жҖ§е’Ңзӣёе…іжҖ§пјҢеҠЈиҙЁжЁЎеһӢдјҡ"жұЎжҹ“"дёҠдёӢж–ҮеҜјиҮҙзӯ”жЎҲиҙЁйҮҸдёӢйҷҚ

**жҠҖжңҜеҸ‘еұ•**пјҡ

* **йқҷжҖҒиҜҚеөҢе…Ҙ**пјҲWord2VecгҖҒGloVeпјүпјҡеӣәе®ҡеҗ‘йҮҸпјҢж— жі•еӨ„зҗҶдёҖиҜҚеӨҡд№ү
* **еҠЁжҖҒдёҠдёӢж–ҮеөҢе…Ҙ**пјҲBERTпјүпјҡеҹәдәҺ Transformer зј–з ҒеҷЁпјҢеҗҢдёҖиҜҚеңЁдёҚеҗҢиҜӯеўғз”ҹжҲҗдёҚеҗҢеҗ‘йҮҸ
* **RAG ж–°иҰҒжұӮ**пјҡйўҶеҹҹиҮӘйҖӮеә”гҖҒеӨҡзІ’еәҰеӨҡжЁЎжҖҒж”ҜжҢҒгҖҒжЈҖзҙўж•ҲзҺҮдёҺж··еҗҲжЈҖзҙў

**и®ӯз»ғеҺҹзҗҶ**пјҡ

* **иҮӘзӣ‘зқЈеӯҰд№**пјҡMLMпјҲжҺ©з ҒиҜӯиЁҖжЁЎеһӢпјүеӯҰд№ иҜҚе…ғдёҺдёҠдёӢж–Үе…ізі»пјҢNSPпјҲдёӢдёҖеҸҘйў„жөӢпјүеӯҰд№ еҸҘеӯҗй—ҙйҖ»иҫ‘е…ізі»
* **ж•Ҳжһңеўһејә**пјҡеәҰйҮҸеӯҰд№ дјҳеҢ–зӣёдјјеәҰжҺ’еәҸпјҢеҜ№жҜ”еӯҰд№ йҖҡиҝҮдёүе…ғз»„пјҲAnchor-Positive-NegativeпјүжӢүиҝ‘зӣёдјјж ·жң¬гҖҒжҺЁиҝңдёҚзӣёдјјж ·жң¬

**йҖүеһӢжҢҮеҚ—**пјҡ

* **еҸӮиҖғ MTEB жҺ’иЎҢжҰң**пјҡе…іжіЁ Retrieval д»»еҠЎжҺ’еҗҚгҖҒиҜӯиЁҖж”ҜжҢҒгҖҒжЁЎеһӢеӨ§е°ҸгҖҒеҗ‘йҮҸз»ҙеәҰгҖҒжңҖеӨ§ Token ж•°
* **иҝӯд»ЈжөӢиҜ•**пјҡжһ„е»әз§ҒжңүиҜ„жөӢйӣҶпјҢеҜ№жҜ”еӨҡдёӘеҖҷйҖүжЁЎеһӢеңЁзңҹе®һдёҡеҠЎеңәжҷҜдёӢзҡ„иЎЁзҺ°пјҢз»“еҗҲжҲҗжң¬иҖғиҷ‘жңҖз»ҲйҖүжӢ©

### 5.2 еӨҡжЁЎжҖҒеөҢе…Ҙ

**еӨҡжЁЎжҖҒеөҢе…ҘпјҲMultimodal Embeddingпјү**пјҡе°ҶдёҚеҗҢзұ»еһӢж•°жҚ®пјҲеӣҫеғҸгҖҒж–Үжң¬гҖҒйҹійў‘зӯүпјүжҳ е°„еҲ°**еҗҢдёҖдёӘе…ұдә«еҗ‘йҮҸз©әй—ҙ**зҡ„жҠҖжңҜпјҢжү“з ҙдј з»ҹж–Үжң¬еөҢе…Ҙзҡ„"жЁЎжҖҒеўҷ"пјҢе®һзҺ°и·ЁжЁЎжҖҒиҜӯд№үеҜ№йҪҗгҖӮ

**дёәд»Җд№ҲйңҖиҰҒ**пјҡзҺ°е®һдҝЎжҒҜжҳҜеӨҡжЁЎжҖҒзҡ„пјҢдј з»ҹж–Үжң¬еөҢе…Ҙж— жі•зҗҶи§Ј"йӮЈеј жңүзәўиүІжұҪиҪҰзҡ„еӣҫзүҮ"иҝҷзұ»жҹҘиҜўпјҢеӣ дёәж–Үжң¬еҗ‘йҮҸе’ҢеӣҫеғҸеҗ‘йҮҸеӨ„дәҺйҡ”зҰ»з©әй—ҙгҖӮеӨҡжЁЎжҖҒеөҢе…ҘйҖҡиҝҮ**и·ЁжЁЎжҖҒеҜ№йҪҗпјҲCross-modal Alignmentпјү**и§ЈеҶіиҝҷдёҖй—®йўҳгҖӮ

**CLIP жЁЎеһӢ**пјҡ

* **жһ¶жһ„**пјҡеҸҢзј–з ҒеҷЁпјҲеӣҫеғҸзј–з ҒеҷЁ + ж–Үжң¬зј–з ҒеҷЁпјүпјҢеҲҶеҲ«е°Ҷеӣҫж–Үжҳ е°„еҲ°е…ұдә«еҗ‘йҮҸз©әй—ҙ
* **и®ӯз»ғзӯ–з•Ҙ**пјҡеҜ№жҜ”еӯҰд№ пјҢжңҖеӨ§еҢ–жӯЈзЎ®еӣҫж–ҮеҜ№зӣёдјјеәҰпјҢжңҖе°ҸеҢ–й”ҷиҜҜй…ҚеҜ№зӣёдјјеәҰ
* **ж ёеҝғиғҪеҠӣ**пјҡйӣ¶ж ·жң¬иҜҶеҲ«пјҢе°ҶеҲҶзұ»д»»еҠЎиҪ¬еҢ–дёәеӣҫж–ҮжЈҖзҙўй—®йўҳпјҢж— йңҖеҫ®и°ғеҚіеҸҜжіӣеҢ–

**BGE-M3 зү№жҖ§**пјҲ"M3"пјүпјҡ

* **еӨҡиҜӯиЁҖжҖ§**пјҡж”ҜжҢҒ 100+ з§ҚиҜӯиЁҖзҡ„еӣҫж–ҮеӨ„зҗҶпјҢе®һзҺ°и·ЁиҜӯиЁҖжЈҖзҙў
* **еӨҡеҠҹиғҪжҖ§**пјҡеҗҢж—¶ж”ҜжҢҒеҜҶйӣҶжЈҖзҙўгҖҒеӨҡеҗ‘йҮҸжЈҖзҙўгҖҒзЁҖз–ҸжЈҖзҙў
* **еӨҡзІ’еәҰжҖ§**пјҡеӨ„зҗҶзҹӯеҸҘеҲ° 8192 token зҡ„й•ҝж–ҮжЎЈ
* **жҠҖжңҜдә®зӮ№**пјҡйҮҮз”ЁзҪ‘ж јеөҢе…ҘпјҲGrid-Based EmbeddingsпјүпјҢе°ҶеӣҫеғҸеҲҶеүІдёәзҪ‘ж јеҚ•е…ғзӢ¬з«Ӣзј–з ҒпјҢжҸҗеҚҮеұҖйғЁз»ҶиҠӮжҚ•жҚүиғҪеҠӣ

**еә”з”ЁеңәжҷҜ**пјҡеӨҡжЁЎжҖҒзҹҘиҜҶжЈҖзҙўгҖҒз»„еҗҲеӣҫеғҸжЈҖзҙўгҖҒеӨҡжЁЎжҖҒжҹҘиҜўзҡ„зҹҘиҜҶжЈҖзҙўзӯү RAG еңәжҷҜгҖӮ

### 5.3 еҗ‘йҮҸж•°жҚ®еә“

**еҗ‘йҮҸж•°жҚ®еә“пјҲVector Databaseпјү**пјҡдё“й—Ёи®ҫи®Ўз”ЁдәҺй«ҳж•ҲеӯҳеӮЁгҖҒз®ЎзҗҶе’ҢжҹҘиҜўй«ҳз»ҙеҗ‘йҮҸзҡ„ж•°жҚ®еә“зі»з»ҹпјҢжҳҜ RAG зі»з»ҹдёӯиҝһжҺҘж•°жҚ®дёҺеӨ§иҜӯиЁҖжЁЎеһӢзҡ„е…ій”®жЎҘжўҒгҖӮ

**дё»иҰҒеҠҹиғҪ**пјҡ

* **й«ҳж•ҲзӣёдјјжҖ§жҗңзҙў**пјҡеҲ©з”Ё HNSWгҖҒIVF зӯүзҙўеј•жҠҖжңҜпјҢеңЁж•°еҚҒдәҝзә§еҗ‘йҮҸдёӯе®һзҺ°жҜ«з§’зә§ ANNпјҲиҝ‘дјјжңҖиҝ‘йӮ»пјүжҹҘиҜў
* **й«ҳз»ҙж•°жҚ®з®ЎзҗҶ**пјҡдјҳеҢ–еӯҳеӮЁй«ҳз»ҙеҗ‘йҮҸпјҲйҖҡеёёж•°зҷҫеҲ°ж•°еҚғз»ҙпјүпјҢж”ҜжҢҒеўһеҲ ж”№жҹҘж“ҚдҪң
* **дё°еҜҢжҹҘиҜўиғҪеҠӣ**пјҡж”ҜжҢҒж ҮйҮҸеӯ—ж®өиҝҮж»ӨгҖҒиҢғеӣҙжҹҘиҜўгҖҒиҒҡзұ»еҲҶжһҗзӯү
* **еҸҜжү©еұ•дёҺй«ҳеҸҜз”Ё**пјҡеҲҶеёғејҸжһ¶жһ„пјҢж°ҙе№іжү©еұ•пјҢе®№й”ҷжҖ§ејә
* **з”ҹжҖҒйӣҶжҲҗ**пјҡдёҺ LangChainгҖҒLlamaIndex зӯү AI жЎҶжһ¶ж— зјқйӣҶжҲҗ

**vs дј з»ҹж•°жҚ®еә“**пјҡ

* **ж ёеҝғе·®ејӮ**пјҡеҗ‘йҮҸж•°жҚ®еә“дё“жіЁдәҺ**зӣёдјјжҖ§жҗңзҙў**пјҲANNпјүпјҢдј з»ҹж•°жҚ®еә“дё“жіЁдәҺ**зІҫзЎ®еҢ№й…Қ**
* **зҙўеј•жңәеҲ¶**пјҡеҗ‘йҮҸж•°жҚ®еә“дҪҝз”Ё HNSWгҖҒLSHгҖҒIVF зӯү ANN зҙўеј•пјҢдј з»ҹж•°жҚ®еә“дҪҝз”Ё B-TreeгҖҒHash Index
* **еә”з”ЁеңәжҷҜ**пјҡеҗ‘йҮҸж•°жҚ®еә“йҖӮз”ЁдәҺ AI еә”з”ЁгҖҒRAGгҖҒжҺЁиҚҗзі»з»ҹпјӣдј з»ҹж•°жҚ®еә“йҖӮз”ЁдәҺдёҡеҠЎзі»з»ҹгҖҒйҮ‘иһҚдәӨжҳ“
* **дә’иЎҘе…ізі»**пјҡдёӨиҖ…з»“еҗҲдҪҝз”ЁпјҢдј з»ҹж•°жҚ®еә“еӯҳеӮЁдёҡеҠЎе…ғж•°жҚ®пјҢеҗ‘йҮҸж•°жҚ®еә“еӨ„зҗҶ AI еҗ‘йҮҸж•°жҚ®

**е·ҘдҪңеҺҹзҗҶ**пјҡйҮҮз”ЁеӣӣеұӮжһ¶жһ„пјҲеӯҳеӮЁеұӮгҖҒзҙўеј•еұӮгҖҒжҹҘиҜўеұӮгҖҒжңҚеҠЎеұӮпјүпјҢдё»иҰҒжҠҖжңҜеҢ…жӢ¬еҹәдәҺж ‘зҡ„ж–№жі•пјҲAnnoyпјүгҖҒеҹәдәҺе“ҲеёҢзҡ„ж–№жі•пјҲLSHпјүгҖҒеҹәдәҺеӣҫзҡ„ж–№жі•пјҲHNSWпјүгҖҒеҹәдәҺйҮҸеҢ–зҡ„ж–№жі•пјҲIVFгҖҒPQпјүгҖӮ

**дё»жөҒдә§е“Ғ**пјҡ

* **Pinecone**пјҡе®Ңе…Ёжүҳз®Ў Serverless жңҚеҠЎпјҢдјҒдёҡзә§зү№жҖ§пјҢйҖӮеҗҲз”ҹдә§зҺҜеўғ
* **Milvus**пјҡејҖжәҗеҲҶеёғејҸпјҢж”ҜжҢҒ GPU еҠ йҖҹпјҢйҖӮеҗҲеӨ§и§„жЁЎйғЁзҪІ
* **Qdrant**пјҡRust ејҖеҸ‘пјҢй«ҳжҖ§иғҪпјҲRPS>4000пјүпјҢйҖӮеҗҲжҖ§иғҪж•Ҹж„ҹеә”з”Ё
* **Weaviate**пјҡж”ҜжҢҒ GraphQLпјҢ20+ AI жЁЎеқ—пјҢйҖӮеҗҲ AI ејҖеҸ‘е’ҢеӨҡжЁЎжҖҒеӨ„зҗҶ
* **Chroma**пјҡиҪ»йҮҸзә§жң¬ең°дјҳе…ҲпјҢйӣ¶й…ҚзҪ®пјҢйҖӮеҗҲеҺҹеһӢејҖеҸ‘е’Ңе°Ҹи§„жЁЎеә”з”Ё

**жң¬ең°еҗ‘йҮҸеӯҳеӮЁпјҲFAISSпјү**пјҡFacebook AI Research ејҖеҸ‘зҡ„й«ҳжҖ§иғҪеә“пјҢе°Ҷзҙўеј•дҝқеӯҳдёәжң¬ең°ж–Үд»¶пјҲ`.faiss` + `.pkl`пјүпјҢиҪ»йҮҸй«ҳж•ҲпјҢйҖӮеҗҲеҝ«йҖҹеҺҹеһӢи®ҫи®Ўе’Ңдёӯе°ҸеһӢеә”з”ЁгҖӮ

### 5.4 Milvusд»Ӣз»ҚеҸҠеӨҡжЁЎжҖҒжЈҖзҙўе®һи·ө

**Milvus**пјҡејҖжәҗзҡ„еҲҶеёғејҸеҗ‘йҮҸж•°жҚ®еә“пјҢдё“дёәеӨ§и§„жЁЎеҗ‘йҮҸзӣёдјјжҖ§жҗңзҙўи®ҫи®ЎпјҢйҮҮз”Ёдә‘еҺҹз”ҹжһ¶жһ„пјҢе…·еӨҮй«ҳеҸҜз”ЁгҖҒй«ҳжҖ§иғҪгҖҒжҳ“жү©еұ•зү№жҖ§пјҢиғҪеӨ„зҗҶеҚҒдәҝзә§з”ҡиҮіжӣҙеӨ§и§„жЁЎеҗ‘йҮҸж•°жҚ®пјҢйҖӮеҗҲз”ҹдә§зҺҜеўғгҖӮ

**ж ёеҝғз»„д»¶**пјҡ

* **CollectionпјҲйӣҶеҗҲпјү**пјҡзұ»дјје…ізі»еһӢж•°жҚ®еә“зҡ„иЎЁпјҢжҳҜж•°жҚ®з»„з»Үзҡ„еҹәжң¬еҚ•дҪҚ

  + **Schema**пјҡе®ҡд№үж•°жҚ®з»“жһ„пјҢеҢ…еҗ«дё»й”®еӯ—ж®өгҖҒеҗ‘йҮҸеӯ—ж®өгҖҒж ҮйҮҸеӯ—ж®ө
  + **PartitionпјҲеҲҶеҢәпјү**пјҡйҖ»иҫ‘еҲ’еҲҶпјҢжҸҗеҚҮжҹҘиҜўжҖ§иғҪпјҢжңҖеӨҡ 1024 дёӘеҲҶеҢә
  + **AliasпјҲеҲ«еҗҚпјү**пјҡдёә Collection жҸҗдҫӣ"жҳөз§°"пјҢе®һзҺ°ж•°жҚ®жӣҙж–°ж—¶зҡ„ж— зјқеҲҮжҚўпјҢд»Јз Ғи§ЈиҖҰ
* **IndexпјҲзҙўеј•пјү**пјҡеҠ йҖҹжЈҖзҙўзҡ„ж•°жҚ®з»“жһ„

  + **FLAT**пјҡжҡҙеҠӣжҗңзҙўпјҢ100% еҸ¬еӣһзҺҮпјҢйҖӮеҗҲе°Ҹи§„жЁЎж•°жҚ®
  + **IVF зі»еҲ—**пјҡеҖ’жҺ’ж–Үд»¶зҙўеј•пјҢйҖҡиҝҮиҒҡзұ»зј©е°ҸжҗңзҙўиҢғеӣҙпјҢжҖ§иғҪдёҺж•Ҳжһңе№іиЎЎ
  + **HNSW**пјҡеҹәдәҺеӨҡеұӮеӣҫзҡ„зҙўеј•пјҢжЈҖзҙўйҖҹеәҰеҝ«гҖҒеҸ¬еӣһзҺҮй«ҳпјҢеҶ…еӯҳеҚ з”ЁеӨ§
  + **DiskANN**пјҡеҹәдәҺзЈҒзӣҳзҡ„еӣҫзҙўеј•пјҢж”ҜжҢҒи¶…еӨ§и§„жЁЎж•°жҚ®пјҲеҚҒдәҝзә§+пјү
* **жЈҖзҙўеҠҹиғҪ**пјҡ

  + **еҹәзЎҖ ANN жЈҖзҙў**пјҡиҝ‘дјјжңҖиҝ‘йӮ»жҗңзҙўпјҢж ёеҝғеҠҹиғҪ
  + **иҝҮж»ӨжЈҖзҙў**пјҡз»“еҗҲеҗ‘йҮҸзӣёдјјжҖ§жЈҖзҙўдёҺж ҮйҮҸеӯ—ж®өиҝҮж»Ө
  + **иҢғеӣҙжЈҖзҙў**пјҡиҝ”еӣһзӣёдјјеәҰеңЁзү№е®ҡиҢғеӣҙеҶ…зҡ„жүҖжңүз»“жһң
  + **еӨҡеҗ‘йҮҸж··еҗҲжЈҖзҙў**пјҡеҗҢж—¶жЈҖзҙўеӨҡдёӘеҗ‘йҮҸеӯ—ж®өпјҢдҪҝз”Ё Reranker иһҚеҗҲз»“жһң
  + **еҲҶз»„жЈҖзҙў**пјҡзЎ®дҝқз»“жһңеӨҡж ·жҖ§пјҢжҜҸдёӘз»„еҸӘеҮәзҺ°жҢҮе®ҡж¬Ўж•°

**еӨҡжЁЎжҖҒжЈҖзҙўе®һи·ө**пјҡдҪҝз”Ё Visualized-BGE жЁЎеһӢе’Ң Milvus жһ„е»әеӣҫж–ҮжЈҖзҙўеј•ж“ҺпјҢжөҒзЁӢеҢ…жӢ¬пјҡеҲқе§ӢеҢ–зј–з ҒеҷЁ вҶ’ еҲӣе»ә CollectionпјҲе®ҡд№ү Schemaпјү вҶ’ жҸ’е…Ҙж•°жҚ®пјҲеӣҫеғҸеҗ‘йҮҸеҢ–пјү вҶ’ еҲӣе»әзҙўеј•пјҲHNSWпјү вҶ’ жү§иЎҢеӨҡжЁЎжҖҒжЈҖзҙўпјҲеӣҫж–Үз»„еҗҲжҹҘиҜўпјү в...