---
title: 恶意代码动态分析对抗与反对抗技术综述
url: https://mp.weixin.qq.com/s/nlbvVlrWwaNRtoPG8YqZpA
source: Doonsec's feed
date: 2026-01-09
fetch_date: 2026-01-10T03:31:06.938928
---

# 恶意代码动态分析对抗与反对抗技术综述

![cover_image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/IgR5nfFgN9OibaSxmJ4H14Y5qIHzzsPobKdlxBaOiaEaibGtbgiadewtiaWKpcHYSBffx76HohqfVF7Tk0yzksqjy6Q/0?wx_fmt=jpeg)

# 恶意代码动态分析对抗与反对抗技术综述

原创

信通传媒

网络与信息安全学报

![]()

在小说阅读器中沉浸阅读

点击蓝字

![](https://mmbiz.qpic.cn/mmbiz_gif/JaFvPvvA2J3MKYVlmXC32WtRJEYsPM9zbyZQtPicnOVfKibj5PuaiarJibbQgR5WWf52x1FicLIhiaweLvCoqia0TGibqg/640?wx_fmt=gif)

关注我们

---

王晨阳1,2彭国军1,2杨秀璋3周逸林1,2

（1.空天信息安全与可信计算教育部重点实验室，湖北 武汉 430072；2.武汉大学国家网络安全学院，湖北 武汉 430072；3.贵州大学公共大数据国家重点实验室，贵州 贵阳 550025 ）

## 摘 要 动态分析是恶意代码分析与检测的关键技术，能够刻画样本在运行时的真实行为特征。在攻防博弈的过程中，恶意代码采用动态分析对抗技术逃避分析，安全研究人员则通过反对抗技术提升分析系统应对规避型恶意软件的能力。已有综述大多聚焦于攻防技术的设计与实现，缺乏对其与恶意代码动态分析各核心环节之间关联的系统梳理。为此，该研究以恶意代码动态分析的工作流程为主线，从攻防对抗的视角出发，对相关技术进行了系统综述。首先，介绍了动态分析的典型工作流程；其次，总结了对抗技术的设计与实现方式，包括恶意载荷隐藏、分析环境感知、行为捕获逃避及分析模型欺骗技术，剖析其规避机制；再次，整理与归纳了相应的反对抗技术，包括恶意载荷捕获、环境感知规避、行为触发与监控增强及分析模型增强技术，揭示动态分析系统演变背后的攻防对抗逻辑；最后，探讨了恶意代码动态分析领域未来的发展趋势与重点研究方向，以期为恶意代码分析与检测研究提供参考。 关键词 恶意代码；动态分析；调试器；沙箱；对抗与反对抗 DOI：10.11959/j.issn.2096-109x.2025063 引言 随着计算机技术的不断发展，恶意代码持续演化迭代，恶意软件攻击的态势日趋严峻。当前，恶意代码的种类与数量在快速增长，木马、勒索软件、挖矿病毒、僵尸网络等传统恶意程序依然活跃，新型恶意代码家族层出不穷[1-3]。与此同时，具有极强隐蔽性、对抗性和破坏性的APT攻击，也常以恶意代码为载体执行信息搜集、数据窃取、持久化控制等攻击任务[4]。在此背景下，构建高效的恶意代码分析系统，精准捕获恶意行为特征并实现软件恶意性检测，已成为网络空间安全治理领域的重要研究课题。 程序动态分析技术通过捕获程序运行过程中的动态信息来解析其行为与特性，目前已被安全研究领域广泛应用于恶意代码分析。其典型工作流程主要包含预处理、分析环境准备、样本执行与行为捕获、行为数据分析4个核心环节。在攻防对抗的持续博弈中，恶意代码逐渐发展出动态分析对抗技术以规避恶意行为的捕获，这类恶意软件被称为规避型恶意软件。攻击者通过无文件攻击等手段隐藏恶意载荷，依托调试器特征与沙箱指纹识别分析环境，借助时延、条件触发等机制逃避行为捕获，并在恶意行为中注入对抗序列以欺骗分析模型，最终形成覆盖动态分析全流程的对抗体系。 为增强动态分析系统对规避型恶意软件的检测能力，研究人员开发了一系列反对抗技术。其一，通过构建溯源图对系统行为进行综合分析，以检测无文件攻击并捕获恶意载荷；其二，升级运行环境，采用更高特权等级的监控方式构建透明分析环境，避免被恶意代码感知到分析环境的存在；其三，利用时延跳过与路径探索技术触发隐藏的恶意功能，同时增强行为监控的抗干扰能力；其四，提升分析模型的鲁棒性，动态优化检测规则，以应对对抗样本带来的威胁。 目前，动态分析对抗与反对抗技术已在恶意代码分析领域的部分综述中被提及[5-6]，也有专门以此为主题的综述研究[7-8]。但现有综述多局限于对攻防技术的孤立讨论，研究视角相对单一，尚未系统建立这些技术与动态分析各核心环节的关联。为此，本文聚焦 Windows 平台的恶意代码分析，以恶意代码动态分析工作流程为主线，归纳相关攻防对抗技术，揭示动态分析系统迭代升级的内在逻辑，并展望未来的研究方向。 1 恶意代码动态分析概述 恶意代码动态分析的典型工作流程如图1所示，具体可划分为以下4个核心阶段。 ![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/IgR5nfFgN9OibaSxmJ4H14Y5qIHzzsPobFn84tmoicRvicXouMvf3L6iaSUTf2wNPBLo2IIrKqGr7IDXFlIhEPsx1Q/640?wx_fmt=jpeg&from=appmsg) 图1   恶意代码动态分析的典型的工作流程 1) 预处理阶段：对软件样本开展初步静态解析，提取文件类型、API导入表等基础特征，为后续动态分析提供可执行代码；同时生成系统环境要求、API Hook监控点位等关键上下文信息。这一阶段的攻防博弈核心在于恶意载荷的隐藏与捕获。 2) 分析环境准备阶段：根据软件样本的类型，利用模拟器、虚拟机等工具构建隔离的运行环境；结合分析需求选取调试器或沙箱等分析方式，为样本运行搭建安全、可靠的分析场景。本阶段的攻防对抗焦点是分析环境的感知与反感知。攻击者通过环境感知技术和工具判断是否处于分析场景，防护方则通过优化环境配置构建高透明度环境以规避感知。 3) 样本执行与行为捕获阶段：通过运行软件样本记录其动态行为，重点捕获样本运行过程中的指令序列、API调用、网络通信、文件操作等行为数据，为后续恶意性检测等分析任务提供核心数据支撑。此阶段的攻防博弈围绕行为隐藏与行为捕获展开。攻击者通过隐藏恶意行为、干扰分析来逃避行为捕获，防护方则通过触发隐藏行为、增强行为监控进行反制。 4) 行为数据分析阶段：对收集到的样本行为数据进行深度分析，采用规则匹配、机器学习、深度学习等方法评估样本的恶意性，并生成分析报告。该阶段的攻防对抗聚焦于模型欺骗与模型增强。攻击者通过构造对抗样本、伪造正常行为等方式欺骗分析模型，防护方则通过优化检测规则、提升模型鲁棒性来增强分析能力。 2 恶意代码动态分析对抗技术 本节围绕恶意代码动态分析的典型工作流程，系统介绍针对各分析环节的对抗技术。 2.1 恶意载荷隐藏 恶意载荷隐藏技术通过隐藏攻击载荷和可执行文件等方式对抗动态分析，其常用的手段主要有代码混淆、软件加壳及无文件攻击技术。 2.1.1 代码混淆 代码混淆是一种软件保护技术，它能够在保持程序功能不变的条件下，通过语义等价变换来隐藏执行逻辑和关键数据，从而有效阻止逆向工程，抵御动/静态分析[9-10]。恶意软件常利用代码混淆技术隐藏恶意载荷，防止其被分析系统提取。 代码混淆可将程序源代码、中间表示或二进制文件作为输入，通过控制流平坦化等方式改写原始程序的控制流结构，通过不透明谓词注入、路径分支混淆[11]等方式保护程序的跳转信息，并利用加密、变量重命名等手段保护程序数据与布局信息，最终生成具备抗分析能力的可执行实体。为应对符号执行等新型自动化分析技术的发展，代码混淆技术已从传统的单一语法层变换，逐步演进为线程间执行路径混淆[12]、多项反混淆技术高效融合[13]、代码虚拟化与闪存控制器软硬件结合[14]等多维度协同混淆。同时，利用大语言模型生成混淆代码的尝试也已出现[15]，进一步提升了混淆的隐蔽性。 恶意代码常利用代码混淆技术隐藏其执行逻辑和数据，这会对动态分析的多个环节造成干扰。在预处理阶段，控制流混淆技术会破坏反汇编和反编译过程（例如，难以依据混淆样本的控制流图还原原始执行逻辑），字符串加密操作则会隐藏样本程序的关键API调用信息，影响分析环境的准备；在样本执行与行为捕获阶段，混淆样本的分支路径过多可能导致“路径爆炸”，大幅降低分析效率。 2.1.2 软件加壳 软件加壳是恶意代码隐藏恶意载荷的另一核心技术。软件加壳是一种软件保护技术，被恶意代码广泛用于隐藏恶意载荷。加壳工具通过压缩、加密等方式隐藏可执行二进制文件的原始内容，并附加脱壳例程。加壳后的程序在运行时会先执行脱壳例程，待原始代码在内存中解密还原后再执行原始代码。为增强对抗分析的能力，软件加壳技术已从最初的简单壳（仅对原始代码进行压缩，执行时通过一次脱壳例程还原原始代码），逐步发展为复杂壳（采用多层壳嵌套结构，且执行时每次脱壳例程仅还原部分原始代码）[16]。相应地，攻击者的保护策略也从单一加壳工具简单保护，升级为多层壳嵌套与多种加壳工具协同使用的复杂方案[17]。 加壳技术对恶意代码抗分析能力的增强，主要体现在对程序结构的破坏与执行信息的隐藏两个方面。一方面，样本的标准文件结构遭到破坏，导致反汇编操作难以有效开展，原始代码语义信息无法准确还原；另一方面，运行时的关键依赖信息（如包含API调用信息的导入表）常被加壳工具清除，这会给分析环境准备阶段的样本行为监控部署带来带来较大阻碍。 2.1.3 无文件攻击 无文件攻击是一种不依赖可执行文件开展恶意行为的新型攻击范式[18]，其典型攻击流程如图2所示。区别于传统攻击方式，此类攻击通过将恶意载荷直接注入内存运行，并深度利用目标系统的合法内置工具（如PowerShell、Office宏等）实施攻击行为，避免了在目标系统中植入持久化恶意软件。凭借其高隐蔽性和低可追溯性特征，无文件攻击已发展成为当前最具威胁的网络攻击手段之一[19]，给恶意代码动态分析技术带来了全方位挑战。 ![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/IgR5nfFgN9OibaSxmJ4H14Y5qIHzzsPobbz0CForeg3JsbaRlOIrW3r5Zlr4F7THaOsl7NRYbGzOkCCPPa3CrWQ/640?wx_fmt=jpeg&from=appmsg) 图 2   无文件攻击的典型攻击流程 无文件攻击的典型特征对动态分析流程的各个环节均构成显著影响。 首先，无文件攻击的恶意载荷以非磁盘文件的形式存在，规避了预处理阶段针对可执行文件实体的常规分析手段。这类攻击具有“不落地”（living-off-the-land, LotL）特点[20]，其生存维持依赖于在注册表等原生系统资源中驻留，而非在目标系统植入持久化恶意软件，这显著增加了恶意载荷的捕获与分析难度。由于无须在磁盘中生成恶意文件，常规预处理阶段通过解析可执行文件获取特征的方法难以奏效。 其次，无文件攻击的动态分析高度依赖精准复现目标环境，对分析环境准备提出了严苛要求。无文件攻击通常通过漏洞利用链获取执行权限，其成功执行往往需要特定的环境条件。分析系统必须构建与真实受害环境高度一致的运行环境（包括操作系统版本、补丁状态、服务配置等），任何环境偏差都可能导致攻击行为无法触发。 最后，在样本执行与行为捕获阶段，聚焦进程行为的监控方式在无文件攻击场景中不再适用。无文件攻击通过合法系统工具（如PowerShell脚本、Office应用程序等）实施恶意操作，要求分析系统必须采用多维度监控策略，对进程行为、内存操作、API调用、网络通信等进行关联分析，才能有效捕获其恶意行为特征。 2.2 分析环境感知 分析环境感知技术旨在检测软件是否运行在分析环境中，并依据检测结果决定是否执行恶意行为。恶意代码常通过检测调试器特征、沙箱痕迹和用户使用情况感知分析环境。 2.2.1 调试器检测 调试器是一种重要的程序分析工具，它通过设置断点、监控和修改程序运行时的状态来实现程序调试。用户通过外部输入设备与调试器交互。 在恶意代码分析领域，调试器检测已成为对抗动态分析的关键技术。恶意代码通常通过感知调试状态与正常执行状态的差异实现调试器检测，具体手段如下。 1) 直接读取调试环境指纹。调试器加载样本程序时，会在系统中留下调试标志位等指纹信息，恶意代码可通过系统接口直接查询这些调试状态信息。 2) 捕获调试操作的可观测痕迹。调试操作会引入可观测痕迹。在调试过程中，断点设置会在代码段插入断点标志，而程序因断点暂停产生的异常耗时也会形成时间偏差。恶意代码可以通过校验代码段完整性（如哈希比对）或时钟计时[21]捕获这些痕迹，进而推断是否被调试。 3) 通过异常处理逻辑验证环境。调试器会接管程序的异常处理流程，这可能破坏恶意代码预设的异常处理逻辑。恶意代码通过主动触发异常并观察处理路径是否被劫持，即可间接判定调试器活动。 4) 扫描调试器关联的标识信息。调试器运行时会生成特定窗口，其窗口类名、标题等特征可作为检测指标，恶意代码通过扫描系统窗口句柄等方式可直接定位调试器关联特征。 2.2.2 沙箱检测 沙箱是一种自动化动态分析工具，通常用于恶意软件的分析与检测。其核心机制是在隔离的环境中运行程序样本，通过系统API Hook、动态二进制插桩（dynamic binary instrumentation, DBI）等技术，在I/O活动、系统调用等层次监测样本的行为，并生成分析报告。为实现环境状态的快速恢复，传统的沙箱通常基于模拟器或虚拟机搭建样本的运行环境。 恶意代码通过识别沙箱软件的运行环境痕迹和行为监控痕迹来实现沙箱检测。 1) 运行环境检测。为便于环境配置和状态恢复，传统的沙箱使用模拟器和虚拟机等工具搭建样本运行环境。与真实物理机系统相比，这类虚拟环境在硬件、软件、网络等层次存在特征差异。恶意代码通过检测这些环境特征，可识别自身是否运行在沙箱系统中[22-25]。目前，多数用于沙箱检测的环境特征仍须通过人工逆向分析获取，但部分特征已可实现自动化提取。Shi等[26]以Intel x86指令手册为依据设计测试用例生成规则，通过在虚拟机与真机环境中自动化运行测试指令并对比执行结果差异，以发现可用于虚拟机环境检测的指令特征。 2) 行为监控检测。沙箱通常采用API Hook、DBI侵入式监控技术捕获样本的API调用等行为数据，但这些技术会在内存中留下可被感知的痕迹。Chailytko等[27]设计了栈平衡校验方法，用于检测Cuckoo沙箱的API Hook痕迹；D'Elia等[28]系统调研了DBI工具的攻击面，发现其存在可被恶意代码感知的透明性缺陷。 2.2.3 用户活动检测 恶意代码动态分析系统的运行环境与日常使用的真实物理机在用户活动痕迹方面存在显著差异，这种差异主要体现在两个维度：其一，在自动化分析流程中，用户与样本的交互行为极少；其二，为降低无关因素干扰，分析系统提供的运行环境通常较为“干净”，缺少真实设备长期使用后形成的“系统老化”特征。 针对用户交互活动少的特点，恶意代码通过“反向图灵测试”验证环境真实性。例如，在执行过程中随机弹出确认信息窗口等。针对运行环境缺少“系统老化”特征的特点，恶意代码通过扫描系统关键位置的“磨损痕迹”识别环境属性。相关研究表明，研究人员通过对比真实用户设备与分析环境在文件系统、配置信息等方面的差异，成功提取出可用于环境识别的“磨损”特征，并在PC和移动平台上实现了对分析环境的感知[29-30]。 2.3 行为捕获逃避 为避免恶意行为被动态分析系统捕获，恶意代码采用时延和条件触发技术隐藏恶意行为，通过干扰分析过程对抗行为监控。 2.3.1 时延 在恶意代码动态分析中，自动化分析系统通常会设定分析时间上限，若样本执行时间超过预设阈值，分析流程会被强制终止。恶意代码正是利用这一特性，通过时延策略推迟恶意功能的执行时间，从而逃避动态分析的捕获。时延主要有睡眠函数调用和迟滞代码两种实现方式。睡眠函数调用，即通过调用Sleep( )等系统API让程序睡眠指定时间，其实现方式简单直接，容易被分析系统通过API监控识别，从而暴露逃避意图。迟滞代码是指通过执行大量冗余操作消耗时间，间接实现延迟效果。与睡眠函数调用相比，这种方式的隐蔽性更强。 2.3.2 条件触发 条件触发是指恶意软件仅在目标环境满足预设条件时才执行恶意操作。尽管条件触发与分析环境感知技术均需要收集环境信息，但二者的核心目标存在显著差异。此类恶意软件更关注与业务场景相关的特征（如系统语言、当前日期、软件版本等），其主要目的并非识别是否处于分析环境，而是确保恶意载荷仅在预期的目标环境中被激活。例如，“震网”（Stuxnet）病毒便以目标系统是否安装西门子工业控制软件作为激活后续攻击流程的必要条件[31]。这种仅在特定条件被满足后才执行的代码片段，通常被称为“逻辑炸弹”。 2.3.3 分析过程干扰 恶意代码通过规避调试跟踪和逃避行为监控等方式干扰分析过程，在确保恶意操作正常执行的同时有效规避行为监控系统的检测。 恶意代码可利用调试器的机制特点规避调试跟踪。例如，干扰调试器与调试子系统之间的隐式通信，可使样本创建不被调试器追踪的进程或线程[32]。此外，通过锁定键盘或鼠标、强制切换桌面等方式干扰交互，也能有效破坏调试过程[33]。 监控API调用序列是沙箱常用的行为监控方法。其常用的实现方式是利用Hook技术修改API函数的头部指令，将控制流重定向到样本监控模块的处理例程中。为避免恶意行为被捕获，恶意代码常采用Sliding Call和Stolen Code技术绕过API头部的Hook代码。此外，恶意代码可通过规避系统DLL的加载与调用机制隐藏API调用，如自主实现DLL装载的Stealth Loader[34]和基于地址空间模糊混淆调用关系的APIASO[35]方案。 2.4 分析模型欺骗 动态分析系统基于程序运行时产生的API调用序列、系统行为等数据完成分析任务。为逃避这类检测，恶意代码通过扰动序列数据和混淆行为轨迹的方式欺骗分析模型，以破坏行为数据分析结果的准确性。 2.4.1 序列数据对抗扰动 作为行为数据分析阶段的一种核心输入，API调用序列容易受到干扰，攻击者可通过对抗样本生成技术对模型判定实施系统性攻击。Rosenberg等[36]首次提出针对API调用序列分类器的端到端黑盒攻击框架GADGET。该框架通过梯度引导的方式插入无害API来干扰模型的注意力。为降低攻击成本，其后续研究[37]结合生成对抗网络与自适应进化算法，有效减少了查询次数。Chen等[38]提出基于注意力机制的API排序算法，优先在关键API位置插入扰动，并利用词移距离优化对抗样本的语义隐蔽性。 为确保对抗样本的隐蔽性与功能完整性，研究者开发了多种实用化生成技术。Kucuk等[39]通过插入虚假调用等源码级修改方式，将恶意代码样本定向误分类至特定家族。Digregorio等[40]结合位置敏感快速梯度符号方法生成最小扰动的API序列，并采用最长已知行为和级联行为优化策略应对动态执行的不确定性；同时通过直接修改二进制字节码保留样本功能，进一步提高对抗样本的隐蔽性。 2.4.2 恶意行为轨迹混淆 针对基于系统操作行为构建的系统行为图分析模型，攻击者可通过构造符合正常行为模式的操作序列，将恶意行为轨迹伪装成合法操作链，从而干扰检测模型对系统因果依赖关系的准确理解。在确保恶意逻辑功能完整性的前提下，攻击者会将恶意操作隐蔽地嵌入合...